version: "2.2"
services:
  martin-redis:
    image: redis:4.0.10
    restart: on-failure
    mem_limit: 256m
    container_name: martin-redis
    ports:
      - 6379:6379
    networks:
      - martin

  martin-extension-monitor:
    build:
      context: ./
      dockerfile: ./martin-extension/martin-extension-monitor/Dockerfile
    restart: on-failure
    mem_limit: 256m
    container_name: martin-extension-monitor
    image: martin-extension-monitor
    environment:
      - SW_AGENT_COLLECTOR_BACKEND_SERVICES=martin-skywalking-oap:11800
    volumes:
      - ./logs:/martin-extension-monitor/logs
      - ./agent:/opt/agent
    command: "java -Djava.security.egd=file:/dev/./urandom -jar -Xms256m -Xmx256m -javaagent:/opt/agent/skywalking-agent.jar -Dskywalking.agent.service_name=MartinExtensionMonitor martin-extension-monitor.jar"
    ports:
      - 9601:9601
    networks:
      - martin

  martin-cloud-gateway:
    build:
      context: ./
      dockerfile: ./martin-cloud/martin-cloud-gateway/Dockerfile
    restart: on-failure
    mem_limit: 256m
    container_name: martin-cloud-gateway
    image: martin-cloud-gateway
    environment:
      - SW_AGENT_COLLECTOR_BACKEND_SERVICES=martin-skywalking-oap:11800
    volumes:
      - ./logs:/martin-cloud-gateway/logs
      - ./agent:/opt/agent
    command: "java -Djava.security.egd=file:/dev/./urandom -jar -Xms256m -Xmx256m -javaagent:/opt/agent/skywalking-agent.jar -Dskywalking.agent.service_name=MartinCloudGateway martin-cloud-gateway.jar"
    ports:
      - 9502:9502
    networks:
      - martin


  martin-biz-auth:
    build:
      context: ./
      dockerfile: ./martin-biz/martin-biz-auth/Dockerfile
    restart: on-failure
    mem_limit: 256m
    container_name: martin-biz-auth
    image: martin-biz-auth
    environment:
      - SW_AGENT_COLLECTOR_BACKEND_SERVICES=martin-skywalking-oap:11800
    volumes:
      - ./logs:/martin-biz-auth/logs
      - ./agent:/opt/agent
    command: "java -Djava.security.egd=file:/dev/./urandom -jar -Xms256m -Xmx256m -javaagent:/opt/agent/skywalking-agent.jar -Dskywalking.agent.service_name=MartinBizAuth martin-biz-auth.jar"
    networks:
      - martin


  martin-biz-resource:
    build:
      context: ./
      dockerfile: ./martin-biz/martin-biz-resource/Dockerfile
    restart: on-failure
    mem_limit: 256m
    container_name: martin-biz-resource
    image: martin-biz-resource
    environment:
      - SW_AGENT_COLLECTOR_BACKEND_SERVICES=martin-skywalking-oap:11800
    volumes:
      - ./logs:/martin-biz-resource/logs
      - ./agent:/opt/agent
    command: "java -Djava.security.egd=file:/dev/./urandom -jar -Xms128m -Xmx128m -javaagent:/opt/agent/skywalking-agent.jar -Dskywalking.agent.service_name=MartinBizResource martin-biz-resource.jar"
    networks:
      - martin


  martin-biz-swagger:
    build:
      context: ./
      dockerfile: ./martin-biz/martin-biz-swagger/Dockerfile
    restart: on-failure
    mem_limit: 256m
    container_name: martin-biz-swagger
    image: martin-biz-swagger
    environment:
      - SW_AGENT_COLLECTOR_BACKEND_SERVICES=martin-skywalking-oap:11800
    volumes:
      - ./logs:/martin-biz-swagger/logs
      - ./agent:/opt/agent
    command: "java -Djava.security.egd=file:/dev/./urandom -jar -Xms128m -Xmx128m -javaagent:/opt/agent/skywalking-agent.jar -Dskywalking.agent.service_name=MartinBizSwagger martin-biz-swagger.jar"
    networks:
      - martin

  martin-biz-system:
    build:
      context: ./
      dockerfile: ./martin-biz/martin-biz-system/Dockerfile
    restart: on-failure
    mem_limit: 256m
    container_name: martin-biz-system
    image: martin-biz-system
    environment:
      - SW_AGENT_COLLECTOR_BACKEND_SERVICES=martin-skywalking-oap:11800
    volumes:
      - ./logs:/martin-biz-system/logs
      - ./agent:/opt/agent
    command: "java -Djava.security.egd=file:/dev/./urandom -jar -Xms256m -Xmx256m -javaagent:/opt/agent/skywalking-agent.jar -Dskywalking.agent.service_name=MartinBizSystem martin-biz-system.jar"
    networks:
      - martin

networks:
  martin:
    external: true
